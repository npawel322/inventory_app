{% extends "inventory/base.html" %}
{% block content %}
<h3>{% if is_admin %}History{% else %}My history{% endif %}</h3>
<table class="table table-striped mt-3">
  <tr>
    <th>Asset</th>
    <th>Office</th>
    <th>Desk</th>
    <th>Department</th>
    <th>Target</th>
    <th>
      Issue
      {% if sort_field == "issue" %}
        {% if sort_dir == "asc" %}
          <a class="text-decoration-none" href="?sort=issue&dir=desc">&uarr;</a>
        {% else %}
          <a class="text-decoration-none" href="?sort=issue&dir=asc">&darr;</a>
        {% endif %}
      {% else %}
        <a class="text-decoration-none" href="?sort=issue&dir=asc">&uarr;</a>
      {% endif %}
    </th>
    <th>
      Due
      {% if sort_field == "due" %}
        {% if sort_dir == "asc" %}
          <a class="text-decoration-none" href="?sort=due&dir=desc">&uarr;</a>
        {% else %}
          <a class="text-decoration-none" href="?sort=due&dir=asc">&darr;</a>
        {% endif %}
      {% else %}
        <a class="text-decoration-none" href="?sort=due&dir=asc">&uarr;</a>
      {% endif %}
    </th>
    <th>Return</th>
  </tr>
  {% for l in loans %}
    <tr class="{% if l.return_date is None and l.due_date and l.due_date < today %}table-danger{% endif %}">
      <td>{{ l.asset }}</td>
      <td>{{ l.office_label }}</td>
      <td>{{ l.desk_label }}</td>
      <td>{{ l.department_label }}</td>
      <td>{{ l.target_label }}</td>
      <td>{{ l.loan_date }}</td>
      <td class="{% if l.return_date is None and l.due_date and l.due_date < today %}text-bg-danger fw-semibold{% endif %}">
        {{ l.due_date|default:"-" }}
      </td>
      <td>{{ l.return_date|default:"-" }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="8" class="text-muted">No history.</td></tr>
  {% endfor %}
</table>
{% endblock %}
